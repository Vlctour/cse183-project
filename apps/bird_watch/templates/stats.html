[[extend 'layout.html']]

<style>
[v-cloak] {
    display: none;
}
#map { 
    height: 750px; 
} /* Increase height for better visibility */
</style>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""/>

<div class="section" id="app" v-cloak>
  <!-- Put your Vue.js template here -->
  <h1 class="title"><i class="fa-solid fa-dove"></i> Stats</h1>
  <div class="field has-addons">
    <div class="control is-expanded">
      <input class="input" type="text" placeholder="Search species">
    </div>
    <div class="control">
      <button class="button is-primary">
        Search
      </button>
    </div>
  </div>
  <div class="columns">
    <div class="list is-one-quarter">
      <table class="table is-fullwidth is-hoverable is-striped">
        <tr>
          <th></th>
          <th>Bird Species</th>
          <th>Last Seen
            <i v-if="sort_most_recent && !is_loading" class="fa fa-sort-amount-desc ml-1 is-clickable" @click="update_sort_by"></i>
            <i v-if="!sort_most_recent && !is_loading" class="fa fa-sort-amount-asc ml-1 is-clickable" @click="update_sort_by"></i>
            <i v-if="is_loading" class="button ml-1 is-loading is-small"></i>
          </th>
        </tr>
        <tr v-for="(bird, row) in selected_stats" :key="row">
          <th>{{(page_number - 1) * items_per_page + row + 1}}</th>
          <td class="is-clickable">{{bird.sightings.name}}</td>
          <td>{{bird.checklists.date}}</td>
        </tr>
      </table>
      <nav class="pagination is-right is-rounded is-small" role="navigation" aria-label="pagination">
        <ul class="pagination-list">
          <button 
            class="button pagination-previous"
            :disabled="first_page"
            @click="update_page(-1)"
          >
            Previous
          </button>
          <button 
            class="button pagination-next"
            :disabled="last_page"
            @click="update_page(1)"
          >
            Next
          </button>
        </ul>
      </nav>
    </div>
    <div class="Auto">
      <canvas id="mySteppedLineChart" width="400" height="200"></canvas>
    </div>
  </div>
</div>
<div id="map"></div>

[[block page_scripts]]
<!-- Loads the index-specific JS for Vue -->
<script>
  let my_callback_url = "[[=XML(my_callback_url)]]";
  let get_stats_url = "[[=XML(get_stats_url)]]";
</script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
<script src="js/stats.js"></script>
<script src="js/leaflet-heat.js"></script>
[[end]]
