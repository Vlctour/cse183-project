[[extend 'layout.html']]

<style>
[v-cloak] {
    display: none;
}
</style>

<div class="section" id="app" v-cloak>
    <div class="modal" :class="{ 'is-active': loading }">
        <div class="modal-background"></div>
        <div class="modal-content">
            <progress class="progress is-small is-primary" max="100" v-if="loading"></progress>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-content">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                    <a class="navbar-item">
                        <h1 class="title">
                            <i class="fa-solid fa-location-dot"></i> 
                            Region: 
                                <span v-if="location && location.city && location.state">{{location.city}}, {{location.state}}</span>
                                <span v-else-if="location && location.country">{{location.country}}</span>
                                <span v-else-if="location && location.man_made">World</span>
                                <span v-else-if="location">{{ location }}</span>
                                <span v-else>Unknown</span>
                        </h1>
                    </a>
                    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                <div id="navbarBasicExample" class="navbar-menu">
                    <div class="navbar-end">
                        <a class="navbar-item" @click="index_redirect">Home</a>
                        <a class="navbar-item" @click="stats_redirect">Stats</a>
                        <a class="navbar-item" @click="checklists_redirect">Checklists</a>
                        <a class="navbar-item" @click="locations_redirect">Locations</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <div class="columns">
        <div class="column is-half">
            <div class="card pb-2">
                <div class="card-content">
                    <h1 class="title">Most Common Species</h1>
                    <table class="table is-fullwidth is-hoverable is-striped">
                        <tr>
                            <th></th>
                            <th>Bird Species</th>
                            <th>Sightings</th>
                        </tr>
                        <tr v-for="(bird, row) in selected_species" :key="row">
                            <th>{{(page_number - 1) * items_per_page + row + 1}}</th>
                            <td class="is-clickable" @click="display_location_data(bird.sightings.id)">{{bird.sightings.name}}</td>
                            <td>{{bird.count}}</td>
                        </tr>
                    </table>
                    <nav class="pagination is-right is-rounded is-small" role="navigation" aria-label="pagination">
                        <ul class="pagination-list">
                            <button 
                            class="button pagination-previous"
                            :disabled="first_page"
                            @click="update_page(-1)"
                            >
                                Previous
                            </button>
                            <button 
                            class="button pagination-next"
                            :disabled="last_page"
                            @click="update_page(1)"
                            >
                                Next
                            </button>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        <div class="column is-half">
            <div class="card">
                <div class="card-content">
                    <h1 class="title">Top Contributors</h1>
                    <table class="table is-fullwidth is-hoverable is-striped">
                        <tr>
                            <th>Observer</th>
                            <th>Unique Bird Species Count</th>
                            <th>Total Observation Time</th>
                        </tr>
                        <tr v-for="contributor in top_contributors">
                            <th>{{contributor.observer_id}}</th>
                            <td>{{contributor.count}}</td>
                            <td>{{format_time(contributor.duration)}}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="card mt-2">
                <div class="card-content">
                    <div class="columns">
                        <div class="column has-text-centered">
                            <strong>Checklist Number</strong>
                            <p>{{checklist_num}}</p>
                        </div>
                        <div class="column has-text-centered">
                            <strong>Number of Sightings</strong>
                            <p>{{num_sightings}}</p>
                        </div>
                    </div> <!-- Closing for the inner columns div -->
                </div>
            </div> <!-- Closing for the card mt-4 div -->
        </div> <!-- Closing for the column is-half div -->
    </div> <!-- Closing for the columns div -->
    <div class="columns is-centered">
        <div class="column is-half">
            <div class="card">
                <div class="card-content has-text-centered">
                    <h1 class="title">Monthly Data Radar Chart</h1>
                    <div style="width: 400px; height: 400px; margin: 0 auto;">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="column is-half">
            <div class="card">
                <div class="card-content has-text-centered">
                    <h1 class="title">{{bird_chart_label_name}} Time Graph</h1>
                    <canvas id="birdChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

[[block page_scripts]]
<script>
    let my_callback_url = "[[=XML(my_callback_url)]]";
    let get_species_url = "[[=XML(get_species_url)]]";
    let get_radar_data_url = "[[=XML(get_radar_data_url)]]";
    let display_location_data_url = "[[=XML(display_location_data_url)]]";
    let handle_redirect_stats_url = "[[=XML(handle_redirect_stats_url)]]";
    let handle_redirect_locations_url = "[[=XML(handle_redirect_locations_url)]]";
    let handle_redirect_checklists_url = "[[=XML(handle_redirect_checklists_url)]]";
    let handle_redirect_index_url = "[[=XML(handle_redirect_index_url)]]";

</script>
<script src="js/location.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
[[end]]
