[[extend 'layout.html']]

<style>
    [v-cloak] {
        display: none;
    }

    #map {
        height: 600px; /* Ensure the height is sufficient */
    }
</style>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<div class="section" id="app" v-cloak>
    <h1 class="title"><i class="fa-solid fa-earth-americas"></i>Index</h1>
    <a href="[[=URL('checklist')]]">Go to About Page</a>
    <div id="map"></div>
</div>

[[block page_scripts]]
<script>
    let my_callback_url = "[[=XML(my_callback_url)]]";

    document.addEventListener('DOMContentLoaded', function () {
        var map = L.map('map').setView([36.974117, -122.030792], 13);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var startPoint = null;
        var drawnRectangle = null;
        var markers = []; // Array to store markers

        // Listen for clicks on the map
        map.on('click', function (e) {
            var clickedPoint = e.latlng;

            // Remove all existing markers
            for (var i = 0; i < markers.length; i++) {
                map.removeLayer(markers[i]);
            }
            markers = []; // Clear the markers array

            if (drawnRectangle) {
                map.removeLayer(drawnRectangle)
            }

            if (!startPoint) {
                // First click: store the starting point and add marker
                startPoint = clickedPoint;
                markers.push(L.marker(clickedPoint).addTo(map)); // Add marker to markers array
            } else {
                // Second click: draw the rectangle, reset starting point, and add marker
                var rectBounds = [startPoint, clickedPoint];
                drawnRectangle = L.rectangle(rectBounds, {color: 'red'}).addTo(map);
                startPoint = null; // Reset the starting point for the next rectangle
                markers.push(L.marker(clickedPoint).addTo(map)); // Add marker to markers array
            }
        });

        function onMapClick(e) {
            // Do nothing for this example
        }

        map.on('click', onMapClick);
    });
</script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="js/index.js"></script>
[[end]]
